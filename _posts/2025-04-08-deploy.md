---
title: 배포
description: 네번째 고난
# author: d_o0o_b
categories: [Minime]
tags: [typography]
# pin: true
math: true
mermaid: true
---

## 개요

드디어 MVP를 완성하고 배포 단계까지 왔습니다. 🥳

역시나, 배포는 큰 고난이였습니다. 하하하,, 프론트엔드에선 예상치 못한 문제들이 터졌고, 서버에선 비용과 안정성 사이에서 많은 고민을 하게 되었습니다.

이번 글에서는 MVP 배포 과정에서 겪었던 네 번째 고난을 정리해보려고 합니다.

<br/>


## 프론트엔드 배포

React Native 앱을 Expo를 이용해 개발했기에 Expo의 빌드 시스템을 활용해 배포하려 했습니다. 그런데...


### 1. 라이브러리 버전 문제

가장 먼저 마주친 문제는 라이브러리 버전 간 충돌이었습니다.  
특정 라이브러리들이 서로 호환되지 않아 빌드 과정에서 오류가 발생했습니다.

> *"왜 로컬에서는 잘 되는데 빌드만 하면 깨지는 걸까..."*

오류 로그를 하나하나 뜯어보며 문제를 일으킨 라이브러리를 삭제하고 재설치하는 방식으로 해결했습니다.  


### 2. 환경변수 (env) 설정

서버 주소를 하드코딩해서 사용하는 건 불편하고 무엇보다도 위험하다는 생각이 들었습니다

먼저 불편하다고 느낀 부분은 development, preview, production 환경마다 서버 주소가 다르기 때문입니다.
하드코딩해버리면 환경을 바꿀 때마다 일일이 코드를 수정해야 하는 번거로움이 생깁니다.

그리고 위험하다고 느낀 부분은 서버 주소가 외부에 노출될 경우 악의적인 요청이 들어올 가능성이 있기 때문입니다.
트래픽이 몰려 서버가 터지거나, 인증 없이 API를 호출하려는 시도들이 생길 수도 있습니다.

그래서 서버 주소는 env파일을 이용해서 환경에 따라 자동으로 바뀌도록 설정하는 방식으로 관리하게 됐습니다.

다행히 Expo에서 환경 변수 설정을 지원하고 있어서 큰 어려움 없이 적용할 수 있었습니다.

[Expo 환경 변수 공식 문서](https://docs.expo.dev/guides/environment-variables/)


### 3. Preview → Production 빌드
먼저 Preview 빌드를 만들어 팀원들과 테스트를 진행했습니다.  
QA를 거치며 CSS 등 몇 가지 수정사항을 반영하고 다시 QA를 진행한 후 프로덕션 빌드로 넘어갔습니다.

Expo의 EAS 빌드를 이용해 `.aab` 파일을 생성하고 Google Play Console에 업로드하여 내부 테스트를 시작했습니다.



### 4. Google Play Console
처음 앱을 개시하는거다 보니 구글 개발자 계정도 이번에 처음 구매를 해봤습니다. 그러다보니 신원 확인과 내부 테스트 과정을 필수로 거쳐야만 플레이 스토어에 앱을 게시할 수 있다는 것을 알게 되었습니다.

신원 인증은 인증 서류가 필요한데 현 주소지를 증명해야 할 증빙서류를 제출하라는 문구를 보고 잠깐 당황을 했습니다. 하하

처음에는 카드 거래내역 조회를 제출했지만 정확한 주소가 나오지 않아서 반려당했습니다.

두 번째에는 등본을 제출하여 통과하였습니다! 🥹

내부 테스트용으로 14일간 열심히 도와줄 12명의 갤럭시 유저들도 섭외 완료했습니다.


<br/>
<br/>

## 백엔드 배포
백엔드는 NestJS + PostgreSQL 기반으로 구성했습니다.
아직 초기 단계라 트래픽도 적을 것을 예상하고 최대한 비용 절감에 집중했습니다.

![Image](https://github.com/user-attachments/assets/10602fea-9e5e-41bc-a59c-2fa9158cc5a6?raw=true)


### 1. 비용을 고려한 구성
AWS EC2 프리 티어 인스턴스를 사용했습니다.

내부에서는 Docker Compose를 이용해 NestJS와 PostgreSQL을 실행 중입니다.

RDB는 아직 과한 선택이라 판단했고 직접 DB 컨테이너를 띄우는 방식도 현재로서 충분하다고 판단했습니다.


### 2. 도메인 & HTTPS 적용
도메인을 구매한 후 AWS ALB (Application Load Balancer)를 사용해 HTTPS를 적용했습니다.

ACM에서 인증서를 발급받고 ALB와 연동해 트래픽을 EC2 인스턴스로 라우팅했습니다.

> 이렇게 구성한 이유는 ALB를 통해 HTTPS 인증서 갱신이 자동으로 되고 추후 로드 밸런싱 확장성까지 고려할 수 있기 때문이었습니다.

<br/>

### 고민: ALB는 과한 선택이었을까?
솔직히 지금 생각해보면...

> "그냥 Nginx로 직접 HTTPS 설정하고 프록시 돌렸어도 됐지 않나?"

맞습니다.

Nginx만으로도 충분히 HTTPS 적용이 가능하고 비용 측면에서도 ALB보다 저렴합니다.
지금 프로젝트 규모에서는 ALB가 약간 오버스펙일 수도 있습니다.

하지만...

추후 트래픽 증가에 따라 로드 밸런서가 필요해질 수 있고 HTTPS 인증 갱신 관리까지 생각하면 AWS 기반에서 확장성을 고려해보는 연습도 좋다고 생각했습니다.
그리고 현재는 스테이징 서버 없이 바로 프로덕션으로 올리고 있지만 향후 요청이 들어온다면 ec2 내부에 스테이징용 Docker를 하나 더 띄우는 것도 생각을 했습니다. 이렇게 되면 ALB 라우팅 처리만 설정하면 구조적으로도 충분히 확장 가능하다고 판단했습니다.

즉, 이번 선택은 현재보다는 미래를 고려한 셋업이었습니다.


## 마무리
아직 내부 테스트 단계에 있으며 배포가 완전히 끝난것은 아니지만 이번 배포 과정은 작은 규모임에도 불구하고 실전 같은 경험이었습니다.

프론트에선 빌드와 환경변수 문제를, 백엔드에선 비용, 인프라 설계, HTTPS 적용을 고민해야 했고 작은 서비스라도 배포는 단순히 “코드 올리기”만이 아니라는 걸 다시금 깨달았습니다.
초기 MVP인 만큼 최대한 간단한 구조로 진행하였지만 앞으로 더 나아갈 수 있도록 조금씩 개선해나가야겠다는 다짐을 했습니다.


그리고 다음 스프린트 전에 `.apk`, `.aab`로 수동 배포하는 대신 CI/CD를 이용해서 머지만 해도 앱스토어에 자동 반영되는 방식을 도입해볼 예정입니다.


