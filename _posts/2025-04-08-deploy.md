---
title: 배포
description: 네번째 고난
# author: d_o0o_b
categories: [Minime]
tags: [typography]
# pin: true
math: true
mermaid: true
---

## 개요

드디어 MVP를 완성하고 배포 단계까지 왔습니다. 🥳

역시나, 배포는 큰 고난이였습니다. 하하하,, 프론트엔드에서는 예상치 못한 문제들이 발생했고 서버에선 비용과 안정성 사이에서 많은 고민을 하게 되었습니다.

이번 글에서는 MVP 배포 과정에서 겪었던 네 번째 고난을 정리해보려고 합니다.

<br/>


## 프론트엔드 배포

React Native 앱을 Expo를 이용해 개발했기에 Expo의 빌드 시스템을 활용해 배포하려 했습니다. 그런데...


### 1. 라이브러리 버전 문제

가장 먼저 마주친 문제는 라이브러리 버전 간 충돌이었습니다.  
특정 라이브러리들이 서로 호환되지 않아 빌드 과정에서 오류가 발생했습니다.

> *"왜 로컬에서는 잘 되는데 빌드만 하면 깨지는 걸까..."*

오류 로그를 하나하나 뜯어보며 문제를 일으킨 라이브러리를 삭제하고 재설치하는 방식으로 해결하였습니다.  

---

### 2. 환경변수 (env) 설정

서버 주소를 하드코딩해서 사용하는 것은 불편하고 무엇보다도 위험하다는 판단하였습니다.

먼저 **불편하다고 느낀 부분**은 `development`, `preview`, `production` 환경마다 서버 주소가 다르기 때문입니다.
하드코딩해버리면 환경을 바꿀 때마다 일일이 코드를 수정해야 하는 번거로움이 생깁니다.

그리고 **위험하다고 느낀 부분**은 서버 주소가 외부에 노출될 경우 악의적인 요청이 들어올 가능성이 있기 때문입니다.
트래픽이 몰려 서버가 터지거나, 인증 없이 API를 호출하려는 시도들이 생길 수도 있습니다.

그래서 서버 주소는 `env`파일을 이용해서 환경에 따라 자동으로 설정되도록 구성하였습니다.

다행히 Expo에서는 환경 변수 설정을 공식적으로 지원하고 있어 큰 어려움 없이 적용할 수 있었습니다.

[Expo 환경 변수 공식 문서](https://docs.expo.dev/guides/environment-variables/)

---

### 3. Preview → Production 빌드
먼저 Preview 빌드를 만들어 팀원들과 테스트를 진행하였습니다.  
QA를 거치며 CSS 등 몇 가지 수정사항을 반영하고 다시 QA를 진행한 후 프로덕션 빌드로 넘어갔습니다.

Expo의 EAS 빌드를 이용하여 `.aab` 파일을 생성하고 Google Play Console에 업로드하여 내부 테스트를 시작하였습니다.

---

### 4. Google Play Console
처음 앱을 출시하는 것이었기 때문에 구글 개발자 계정을 새로 구매하였습니다.  

이에 따라 신원 확인과 내부 테스트 과정을 필수로 거쳐야 플레이 스토어에 앱을 게시할 수 있다는 것을 알게 되었습니다.

신원 인증 단계에서 현 주소지를 증명할 수 있는 서류를 제출해야 했는데  
처음에는 카드 거래내역을 제출하였다가 주소 정보가 누락되어 반려되었습니다.  
이후 주민등록등본을 제출하여 인증을 통과하였습니다! 🥹

내부 테스트용으로 14일간 도와줄 12명의 갤럭시 유저도 섭외를 완료하였습니다.


<br/>
<br/>

## 백엔드 배포
백엔드는 NestJS + PostgreSQL 기반으로 구성하였습니다.
아직은 초기 단계라 트래픽이 적을 것으로 예상되어 최대한 비용 절감에 집중하였습니다.

![Image](https://github.com/user-attachments/assets/10602fea-9e5e-41bc-a59c-2fa9158cc5a6?raw=true)


### 1. 비용을 고려한 구성
AWS EC2 프리 티어 인스턴스를 사용하였습니다.

내부에서는 Docker Compose를 이용하여 NestJS와 PostgreSQL을 실행 중입니다.

아직 RDB는 과한 선택일 수 있다고 판단했고 DB 컨테이너를 직접 띄우는 방식도 현재로서는 충분하다고 보았습니다.

---

### 2. 도메인 & HTTPS 적용
도메인을 구매한 후 AWS ALB(Application Load Balancer)를 사용하여 HTTPS를 적용하였습니다.

ACM에서 인증서를 발급받고 ALB와 연동하여 트래픽을 EC2 인스턴스로 라우팅하였습니다.

> 이렇게 구성한 이유는 ALB를 통해 HTTPS 인증서 갱신이 자동으로 이루어지고 추후 로드 밸런싱 확장성까지 고려할 수 있기 때문이었습니다.

<br/>

### 고민: ALB는 과한 선택이었을까?
솔직히 지금 생각해보면...

> "그냥 Nginx로 직접 HTTPS 설정하고 프록시를 돌렸어도 됐지 않았을까?"

맞습니다.

Nginx만으로도 충분히 HTTPS 적용이 가능하고 비용 측면에서도 ALB보다 저렴합니다.
현 프로젝트 규모에서는 ALB가 다소 오버스펙일 수도 있습니다.

하지만...

추후 트래픽 증가에 따라 로드 밸런서가 필요해질 수 있고 HTTPS 인증 갱신 관리까지 생각하면 AWS 기반의 확장성을 고려한 이번 선택이 좋은 연습이 되었다고 생각합니다.  

현재는 스테이징 서버 없이 프로덕션으로만 운영 중이지만 향후 요청이 들어온다면 EC2 내부에 스테이징용 Docker 컨테이너를 하나 더 띄우는 것도 고려 중입니다. 
이렇게 되면 ALB 라우팅만 조정하면 구조적으로 확장 가능한 상태가 됩니다.

즉, 이번 선택은 **현재보다는 미래를 고려한 셋업**이었습니다.

<br/>

## 마무리
아직 내부 테스트 단계에 있으며 배포가 완전히 끝난것은 아니지만 이번 배포 과정은 작은 규모임에도 불구하고 실전 같은 경험이었습니다.

프론트에서는 빌드와 환경변수 문제를, 백엔드에서는 비용, 인프라 설계, HTTPS 적용을 고민해야 되었고 작은 서비스라도 배포는 단순히 "코드 올리기"가 아님을 다시금 꺠닫게 되었습니다.

<!-- 초기 MVP인 만큼 최대한 간단한 구조로 진행하였지만 앞으로 더 나아갈 수 있도록 조금씩 개선해나가야겠다는 다짐을 했습니다. -->

그리고 다음 스프린트에서는 `.apk`, `.aab`를 수동으로 배포하는 대신 **CI/CD 파이프라인을 도입하여 머지 시 앱스토어에 자동 반영되는 방식**을 적용할 예정입니다.


[EAS Update 기반 배포 경험 글 보러가기](https://d-o0o-b11.github.io/posts/eas-update/)