---
title: 로그인이 필수는 아니다.  #JWT 토큰을 사용한 이유
description: 우리는 어떻게 인증해야 하는가?
categories: [Dev-Notes, Practice]
tags: [typography]
math: true
mermaid: true
---

## 개요
대부분 온라인 서비스에서 로그인이 필수라고 생각하지만, 정말 반드시 필요한 걸까?
로그인이 없다면 보안이 취약해질까? 사용자 경험은 어떻게 달라질까?

서비스를 설계할 때 인증(Authentication)은 필수적인 고민 중 하나입니다.
어떤 방식으로 사용자를 식별하고 얼마나 안전하게 보호할 것인지 그리고 사용자 경험을 해치지 않으면서 인증을 수행할 방법은 무엇인지 고려해야 합니다.

<br/>


## 로그인 없이도 사용자 구분이 가능하다
로그인은 너무 당연하게 여겨지지만, 사실 로그인 없이도 원하는 기능을 구현할 수 있습니다. 로그인의 목적은 단순합니다. 요청을 **'누가'** 보냈는지 식별하는 것입니다. 이를 위해서는 단순한 문자나 숫자만으로도 사용자를 구분할 수 있습니다.

하지만 여기서 몇 가지 문제가 발생할 수 있습니다.
1. 오타로 인해 다른 사용자로 인식될 수 있습니다.
2. 누군가 다른 사람인 척할 수 있습니다.

이 문제를 해결하려면 사용자가 본인임을 증명할 방법이 필요합니다. 이를 위해 일반적으로 ID, PW(비밀번호) 쌍을 사용한 인증 방식을 사용합니다.

<br/>

### 정리
사용자의 이름 같은 단순한 정보도 User Credentials(사용자 인증 정보)가 될 수 있습니다. 
하지만 이는 보안적으로 취약합니다.

- 누구나 볼 수 있습니다.
- 악의적으로 조작될 수 있습니다.

>User Credentials: 사용자가 누구인지 증명하는 정보

<br/>

### 위 문제를 해결하기 위해
1. 누구나 볼 수 있다.
    - HTTPS를 사용해 네트워크 상에서 데이터가 암호화되도록 합니다.

2. 악의적으로 조작할 수 있다.
    - 세션(Session)이나 토큰(Token)을 사용하여 검증된 사용자만 접근할 수 있도록 합니다.

<br/>

## 로그인은 어떻게 동작할까?
매번 요청을 보낼 때마다 ID와 PW를 함께 전송하면 문제를 해결할 수 있을까? 

이론적으로는 가능하지만, 현실적으로는 불편합니다. 매 요청마다 ID와 PW를 입력하는 것은 사용자 경험을 저하시킵니다.

이 문제를 해결하기 위해 **로그인** 개념이 등장했습니다. 사용자가 한 번 인증을 마치면 이후 요청에서는 해당 사용자를 자동으로 식별할 수 있도록 하는 방식입니다. 이를 위해 **인증 후 특정한 임의의 코드(Token)**를 발급합니다. 이후 사용자는 매 요청마다 ID, PW를 직접 입력하지 않고 발급받은 Token을 이용하여 본인을 인증할 수 있습니다.

<br/>

## Token과 Session은 User Credentials의 또 다른 형태일 뿐
로그인의 본질은 **User Credentials**를 안전하게 전달하는 것입니다.
가장 단순한 형태는 사용자의 이름이 될 수도 있지만, 보안적으로 취약하기 때문에 더 안전한 User Credentials 방식인 Session과 Token을 활용합니다.

<br/>

>Token과 Session은 User Credentials의 또 다른 형태일 뿐입니다. 
>로그인 과정은 User Credentials를 안전하게 유지하고 전달하는 방식을 고민하는 과정입니다.
{: .prompt-info }

<br/>

## Auth를 적용하면서 고민했던 점

### 1. JWT 사용하면서 겪었던 문제
처음에는 JWT를 AT + RT 구조로 사용했습니다. 하지만 JWT 자체가 서버에서 상태를 관리하지 않는 구조이기 때문에 만료된 AT를 강제로 막는 것이 어려웠습니다.

#### 발생할 수 있는 문제
- 로그아웃해도 AT가 만료될 때까지 유효
- 사용자가 탈퇴해도 기존 JWT를 보유하고 있으면 API 요청 가능

#### 해결 방법
- RT를 DB에서 관리 → 사용자가 로그아웃하면 RT 삭제
- AT 블랙리스트 도입 → 강제 만료가 필요한 경우 블랙리스트에 등록

>더 이상 만료된 AT가 API 요청에 사용될 수 없도록 개선했습니다! 😀
{: .prompt-tip }

<br/>

### 2. RT를 어떻게 관리할까?
JWT를 사용할 때 RT를 어디에 저장할 것인지도 중요한 고민이었습니다.

#### 문제점
- RT를 브라우저 스토리지에 저장하면 보안 이슈 발생 가능
- RT를 DB에 저장하면 추가적인 I/O 비용 발생

#### 해결 방법
- RT를 DB에 저장 (보안 강화를 위해)
- HttpOnly 쿠키에 저장하여 클라이언트에서 접근 불가능하도록 처리

>보안성과 편의성을 모두 잡을 수 있었습니다! 🤩
{: .prompt-tip }

<br/>

### 3. 해커톤에서 로그인 기능을 개발하는 데 시간을 투자하는 게 맞을까?
해커톤에서는 보안, 확장성, 사용자 경험을 신경 쓰기보다 빠르게 MVP를 개발하는 것이 중요합니다. 따라서 해커톤에서는 간단하게 사용자의 PK를 토큰으로 활용하는 방식을 선택했습니다.

>결과적으로 MVP 기능을 보다 빠르게 개발할 수 있었습니다! 😊
{: .prompt-tip }

<br/>


### 4. 쿠키 활용
JWT를 저장하는 방법으로 쿠키(Cookie)를 활용할 수 있습니다.
쿠키를 이용하면 클라이언트에서 로컬스토리지 같은 별도의 저장 공간을 사용하지 않아도 되며, 보안성이 더 강화될 수 있습니다.

#### 장점
- HttpOnly 옵션을 사용하면 클라이언트에서 접근할 수 없기 때문에 XSS 공격을 방지할 수 있습니다.
- 서버에서 `cookie.get`을 통해 쉽게 접근 가능하여 프론트엔드에서 토큰을 직접 관리할 필요가 없습니다.
- 같은 도메인 내에서는 쿠키가 자동 포함되므로, API 요청 시 인증 과정을 간편하게 처리할 수 있습니다.

>⚠️ **주의할 점** <br/>
>쿠키는 도메인이 같아야 공유 가능합니다! 
{: .prompt-info }

<br/>


## 결론
로그인은 사용자 인증을 보다 간편하고 안전하게 하기 위해 도입된 방법입니다. 본질적으로 로그인은 **'내가 누구인지 증명하는 과정'**이며, 이 과정을 최적화하기 위해 User Credentials의 형태를 바꾸어 가는 과정입니다.

단순히 세션과 토큰 중 하나를 선택하는 것이 아니라 서비스에 맞는 인증 방식이 무엇인지 고민해야 합니다.

- 보안이 중요한가?
- 확장성이 중요한가?
- 사용자 경험을 최적화할 수 있는가?

> 최적의 선택은 <br/>
> JWT + HttpOnly Cookie + RT + 짧은 AT 만료 시간, <br/>
> Session시 Redis 같은 저장소와 함께 운영
{: .prompt-tip }

<br/>
<br/>


## 추가 설명

### Session 기반 인증
>서버에서 발급하는 User Credentials

#### 장점
- 서버에서 세션을 관리하기 때문에 보안성이 상대적으로 높습니다.
- 세션 정보를 변경하면 즉시 반영할 수 있어 유효성을 조정하기 쉽습니다.

#### 단점

- 서버에서 세션을 저장해야 하므로 확장성이 낮습니다.
- 여러 서버에서 세션을 공유하려면 별도의 세션 스토리지(Redis 등)가 필요합니다.

<br/>

### Token 기반 인증(JWT)
>클라이언트가 보관하는 User Credentials

#### 장점
- 서버에 상태 정보를 저장할 필요 없이 stateless하게 인증 가능하여 확장성이 좋습니다.
- JWT 안에 필요한 정보(사용자 ID, 권한 등)를 담아 한 번 발급하면 별도의 서버 조회 없이 검증할 수 있습니다.

#### 단점
- 토큰이 한 번 발급되면 변조가 어렵기 때문에 강제 만료하려면 추가적인 블랙리스트 관리가 필요합니다.
- 토큰 크기가 커질수록 네트워크 부담이 증가할 수 있습니다.